<!-- index.html -->
<!DOCTYPE html>
<html dir="rtl" lang="ar">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="app_title">ุจุฑูุงูุฌ ุตูุงู ูุตูุงุฉ ุฏุงููุฏ ุนููู ุงูุณูุงู - ูุณุฎุฉ ูุชูุฏูุฉ</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d1b3d">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="page-container">
        <header class="header">
            <div class="header-top">
                <div class="lang-switch">
                    <button id="langAr" class="lang-btn active" data-lang="ar">ุงูุนุฑุจูุฉ</button>
                    <button id="langEn" class="lang-btn" data-lang="en">English</button>
                </div>
            </div>
            <h1 data-i18n="header_title">ุจุฑูุงูุฌ ุตูุงู ูุตูุงุฉ ุฏุงููุฏ ุนููู ุงูุณูุงู</h1>
            <p class="subtitle" data-i18n="header_subtitle">ุฑุญูุฉ ุฑูุญุงููุฉ ูุจุงุฑูุฉ โข ุดูุฑ ูุงูู</p>
            <div class="location-info" id="locationInfo" onclick="openSettings()">
                <span>๐</span>
                <span id="locationText" data-i18n="loc_detecting">ุฌุงุฑู ุชุญุฏูุฏ ุงููููุน...</span>
            </div>
        </header>

        <main class="content">
            <div class="view-controls">
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('grid')" id="btnGrid" data-i18n="btn_grid">๐ ุนุฑุถ ุงูุดุจูุฉ</button>
                    <button class="view-btn" onclick="switchView('list')" id="btnList" data-i18n="btn_list">๐ ุนุฑุถ ุงููุงุฆูุฉ</button>
                </div>

                <div class="action-btns">
                    <button class="action-btn" onclick="window.print()" data-i18n="btn_print">๐จ๏ธ ุทุจุงุนุฉ</button>
                    <button class="action-btn" onclick="downloadNotes()" data-i18n="btn_download_notes">๐พ ุชุญููู ุงูููุงุญุธุงุช</button>
                    <label class="action-btn" style="margin:0;">
                        <span data-i18n="btn_import_notes">๐ ุงุณุชูุฑุงุฏ ุงูููุงุญุธุงุช</span>
                        <input type="file" accept=".json" onchange="uploadNotes(event)" style="display:none;">
                    </label>
                    <button class="action-btn" onclick="openSettings()" data-i18n="btn_settings">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
                    <button class="action-btn" onclick="requestNotifications()" data-i18n="btn_enable_notifs">๐ ุชูุนูู ุงูุชูุจููุงุช</button>
                    <button class="action-btn" onclick="enableAdhanSound()" data-i18n="btn_enable_adhan">๐ ุชูุนูู ุตูุช ุงูุฃุฐุงู</button>
                    <button class="action-btn" onclick="stopAdhan()" id="stopAdhanBtn" style="display:none;" data-i18n="btn_stop_adhan">โน๏ธ
                        ุฅููุงู ุงูุฃุฐุงู</button>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-icon" style="background: var(--sage); color: white;">โ</div>
                    <span data-i18n="legend_notes">ุชู ูุชุงุจุฉ ููุงุญุธุงุช</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon" style="background: linear-gradient(135deg, #f0f5ed, #fff); border: 2px solid var(--sage);">๐
                    </div>
                    <span data-i18n="legend_fasting">ููู ุตูุงู</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon" style="background: linear-gradient(135deg, #f5f0f7, #fff); border: 2px solid var(--lavender);">
                        ๐ช</div>
                    <span data-i18n="legend_gym">ููู ุฌูู</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon"
                        style="background: linear-gradient(135deg, #fff7f0, #fff); border: 2px solid var(--rose-gold);">๐</div>
                    <span data-i18n="legend_adhan">ุชูุจูู ุงูุฃุฐุงู</span>
                </div>
            </div>

            <div id="calendarGrid" class="calendar-grid"></div>
            <div id="listView" class="list-view"></div>
        </main>

        <div id="expandedView" class="expanded-view">
            <div class="expanded-card">
                <button class="close-btn" onclick="closeExpanded()">โ</button>
                <div id="expandedContent"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h2 data-i18n="settings_title">โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุจุฑูุงูุฌ</h2>

            <div class="form-group">
                <label for="startDate" data-i18n="label_start_date">๐ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
                <input type="date" id="startDate" value="">
            </div>

            <div class="form-group">
                <label for="duration" data-i18n="label_duration">โฑ๏ธ ูุฏุฉ ุงูุชุญุฏู (ุจุงูุฃูุงู)</label>
                <input type="number" id="duration" min="1" max="365" value="90">
            </div>

            <div class="form-group">
                <label for="countrySelect" data-i18n="label_country">๐ ุงูุจูุฏ</label>
                <select id="countrySelect">
                    <option value="" data-i18n="country_loading">ุฌุงุฑู ุงูุชุญููู...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="cityInput" data-i18n="label_city">๐๏ธ ุงููุฏููุฉ</label>
                <div style="display:flex; gap:10px; align-items:start;">
                    <div class="autocomplete-wrap" style="flex:1;">
                        <input type="text" id="cityInput" placeholder="" oninput="handleCityInput(event)"
                            onkeydown="handleCityKeydown(event)" autocomplete="off">
                        <div id="citySuggestions" class="suggestions"></div>
                    </div>
                    <button onclick="searchCity()" class="btn-search" id="btnSearchCity" data-i18n="btn_search">๐ ุจุญุซ</button>
                </div>
                <small class="muted" data-i18n="city_help">ุงูุชุจ ุงุณู ูุฏููุชู ูุณุชุธูุฑ ูู ุงูุชุฑุงุญุงุช ุชููุงุฆูุงู โข ููููู ุฃูุถุงู ุงูุถุบุท Enter ุฃู ุฒุฑ
                    "ุจุญุซ"</small>
            </div>

            <div class="form-group">
                <label data-i18n="label_coords">๐ ุงูุฅุญุฏุงุซูุงุช (ุชููุงุฆู)</label>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div>
                        <input type="number" id="latitudeInput" placeholder="" step="0.0001" style="width:100%;">
                        <small class="muted" data-i18n="label_lat">Latitude</small>
                    </div>
                    <div>
                        <input type="number" id="longitudeInput" placeholder="" step="0.0001" style="width:100%;">
                        <small class="muted" data-i18n="label_lng">Longitude</small>
                    </div>
                </div>
                <small class="muted" data-i18n="coords_help">โจ ูุชู ุงูุญุตูู ุนูููุง ุชููุงุฆูุงู ุนูุฏ ุงุฎุชูุงุฑ ูุฏููุฉ โข ูููู ุงูุชุนุฏูู ูุฏููุงู ููุฏูุฉ
                    ุงูุนุงููุฉ</small>
            </div>

            <div class="form-group">
                <label for="calculationMethod" data-i18n="label_method">๐ ุทุฑููุฉ ุงูุญุณุงุจ</label>
                <select id="calculationMethod">
                    <option value="4" data-i18n="method_ummalqura">ุฃู ุงููุฑู (ุงูุณุนูุฏูุฉ)</option>
                    <option value="1" data-i18n="method_karachi">ุฌุงูุนุฉ ุงูุนููู ุงูุฅุณูุงููุฉ (ูุฑุงุชุดู)</option>
                    <option value="2" data-i18n="method_eg">ุงูููุฆุฉ ุงูุนุงูุฉ ุงููุตุฑูุฉ ูููุณุงุญุฉ</option>
                    <option value="3" data-i18n="method_mwl">ุฑุงุจุทุฉ ุงูุนุงูู ุงูุฅุณูุงูู</option>
                    <option value="5" data-i18n="method_karachi2">ุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ (ูุฑุงุชุดู)</option>
                    <option value="7" data-i18n="method_tehran">ูุนูุฏ ุงูุฌููููุฒูุงุก (ุทูุฑุงู)</option>
                    <option value="8" data-i18n="method_isna">ุงูุงุชุญุงุฏ ุงูุฅุณูุงูู ูุฃูุฑููุง ุงูุดูุงููุฉ</option>
                </select>
            </div>

            <div class="form-group">
                <label data-i18n="label_notifs_adhan">๐ ุงูุชูุจููุงุช ูุตูุช ุงูุฃุฐุงู</label>
                <div class="toggle-row">
                    <span data-i18n="toggle_notifs">ุชูุนูู ุงูุชูุจููุงุช (ูุณุชูุฒู ุฅุฐู ุงููุชุตูุญ)</span>
                    <label class="switch">
                        <input type="checkbox" id="toggleNotifs">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="toggle-row" style="margin-top:12px;">
                    <span data-i18n="toggle_adhan">ุชุดุบูู ุตูุช ุงูุฃุฐุงู ุนูุฏ ุงูุฃุฐุงู</span>
                    <label class="switch">
                        <input type="checkbox" id="toggleAdhanSound">
                        <span class="slider"></span>
                    </label>
                </div>
                <!-- the volume change direction when arabic  -->
                <div class="form-group" style="margin-top:15px; display: flex; align-items: center; gap: 10px;">
                    <span class="volume-sign">๐ โ</span>
                    <input type="range" id="adhanVolume" min="0" max="1" step="0.02" style="flex: 1;">
                    <span class="volume-sign">+</span>
                </div>

                <div class="form-group">
                    <label for="adhanSrc" data-i18n="label_adhan_src">๐ป ุฑุงุจุท ููู ุงูุฃุฐุงู (ุงุฎุชูุงุฑู)</label>
                    <input type="url" id="adhanSrc" placeholder="">
                </div>
            </div>

            <button class="btn-primary" onclick="saveSettings()" data-i18n="btn_save">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
            <button class="btn-secondary" onclick="closeSettings()" data-i18n="btn_cancel">ุฅูุบุงุก</button>

            <div class="sugg-footer" data-i18n="sugg_footer">๐ ุจูุงูุงุช ุงูุงูุชุฑุงุญุงุช ููุฏูุฉ ูู OpenStreetMap (Nominatim)</div>
        </div>
    </div>

    <!-- Hidden audio for Adhan (no crossorigin to avoid CORS errors on some hosts) -->
    <audio id="adhanAudio" preload="auto">
        <source src="https://cdn.statically.io/gh/abuanwar072/adhan-audio/main/adhan-makkah.mp3" type="audio/mpeg">
        <source src="https://cdn.statically.io/gh/akhampariya/Prayer-Times-Adhan/main/adhan/azan-makkah.mp3" type="audio/mpeg">
    </audio>

    <script src="app.js"></script>
</body>

</html>
