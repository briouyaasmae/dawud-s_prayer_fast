<!DOCTYPE html>
<html dir="rtl" lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØµÙŠØ§Ù… ÙˆØµÙ„Ø§Ø© Ø¯Ø§ÙˆÙˆØ¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù… - Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="icon" type="image/x-icon" href="favicon_io/favicon.ico">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;600;700&display=swap');

        :root {
            --midnight: #1a1625;
            --deep-purple: #2d1b3d;
            --royal-plum: #3d2645;
            --soft-mauve: #544263;
            --rose-gold: #d4a574;
            --champagne: #e8d5b7;
            --cream: #f9f5f0;
            --white: #ffffff;
            --sage: #8b9d83;
            --mist: #b8a8c0;
            --lavender: #9a8ba3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(160deg, var(--midnight) 0%, var(--deep-purple) 40%, var(--royal-plum) 100%);
            min-height: 100vh;
            color: var(--cream);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(212, 165, 116, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 157, 131, 0.02) 0%, transparent 50%);
            pointer-events: none;
        }

        .page-container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: 0 0 80px rgba(0, 0, 0, 0.5);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--royal-plum) 0%, var(--deep-purple) 100%);
            padding: 40px 50px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--rose-gold) 20%, 
                var(--champagne) 50%, 
                var(--rose-gold) 80%, 
                transparent 100%);
        }

        h1 {
            font-family: 'Amiri', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            color: var(--champagne);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            color: var(--mist);
            font-weight: 300;
            letter-spacing: 1.5px;
        }

        /* Main Content */
        .content {
            padding: 30px;
            background: var(--cream);
        }

        /* View Toggle */
        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            background: var(--cream);
            padding: 5px;
            border-radius: 30px;
        }

        .view-btn {
            padding: 12px 30px;
            border: none;
            background: transparent;
            color: var(--royal-plum);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: linear-gradient(135deg, var(--royal-plum) 0%, var(--deep-purple) 100%);
            color: var(--champagne);
            box-shadow: 0 4px 15px rgba(61, 38, 69, 0.3);
        }

        .action-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            border: 2px solid var(--champagne);
            background: var(--white);
            color: var(--royal-plum);
            font-family: 'Tajawal', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: var(--champagne);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
        }

        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 15px;
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--royal-plum);
        }

        .legend-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        /* Calendar Grid View */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: var(--white);
            border-radius: 15px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .grid-cell:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-color: var(--rose-gold);
        }

        .grid-cell.fasting {
            background: linear-gradient(135deg, #f0f5ed 0%, #ffffff 100%);
            border-color: var(--sage);
        }

        .grid-cell.gym {
            background: linear-gradient(135deg, #f5f0f7 0%, #ffffff 100%);
            border-color: var(--lavender);
        }

        .grid-cell.has-notes {
            box-shadow: 0 0 0 3px var(--rose-gold) inset;
        }

        .grid-cell.has-notes::before {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            background: var(--sage);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(139, 157, 131, 0.5);
        }

        .cell-date {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--deep-purple);
            font-family: 'Amiri', serif;
        }

        .cell-day {
            font-size: 0.85rem;
            color: var(--soft-mauve);
            margin-bottom: 8px;
        }

        .cell-badges {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: auto;
        }

        .mini-badge {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            text-align: center;
            font-weight: 600;
        }

        .mini-badge.fasting {
            background: var(--sage);
            color: white;
        }

        .mini-badge.gym {
            background: var(--lavender);
            color: white;
        }

        /* Expanded Card View */
        .expanded-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 22, 37, 0.95);
            z-index: 1000;
            overflow-y: auto;
            padding: 40px 20px;
            animation: fadeIn 0.3s ease;
        }

        .expanded-view.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .expanded-card {
            background: var(--white);
            border-radius: 30px;
            max-width: 900px;
            width: 100%;
            padding: 40px;
            position: relative;
            animation: slideUp 0.4s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            border: none;
            background: var(--cream);
            color: var(--royal-plum);
            font-size: 1.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: var(--royal-plum);
            color: white;
            transform: rotate(90deg);
        }

        .card-header {
            text-align: center;
            padding-bottom: 25px;
            border-bottom: 3px solid var(--champagne);
            margin-bottom: 30px;
        }

        .card-title {
            font-family: 'Amiri', serif;
            font-size: 2rem;
            color: var(--deep-purple);
            margin-bottom: 10px;
        }

        .card-date {
            font-size: 1.2rem;
            color: var(--soft-mauve);
        }

        .info-box {
            background: linear-gradient(135deg, var(--cream) 0%, #ffffff 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid var(--champagne);
        }

        .info-title {
            font-weight: 700;
            color: var(--deep-purple);
            margin-bottom: 12px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--cream);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--soft-mauve);
            font-weight: 600;
        }

        .info-value {
            color: var(--royal-plum);
            font-weight: 700;
            direction: ltr;
            text-align: left;
        }

        .notes-section {
            background: linear-gradient(135deg, #fdfbf9 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 15px;
            border: 3px dashed var(--champagne);
            margin-top: 20px;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .notes-title {
            font-family: 'Amiri', serif;
            font-size: 1.3rem;
            color: var(--deep-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .save-indicator {
            color: var(--sage);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid var(--champagne);
            border-radius: 12px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1.05rem;
            line-height: 1.9;
            color: var(--royal-plum);
            background: var(--white);
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: var(--rose-gold);
            box-shadow: 0 0 0 4px rgba(212, 165, 116, 0.1);
        }

        textarea::placeholder {
            color: #a89dad;
            font-style: italic;
        }

        /* List View (Original) */
        .list-view {
            display: none;
        }

        .list-view.active {
            display: block;
        }

        .week-section {
            margin-bottom: 40px;
        }

        .week-header {
            font-family: 'Amiri', serif;
            font-size: 1.4rem;
            color: var(--deep-purple);
            text-align: center;
            padding: 15px;
            background: var(--white);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--champagne);
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .day-card {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            border: 3px solid #e8dcd0;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.06);
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            border-color: var(--rose-gold);
        }

        .day-card.fasting {
            border-color: var(--sage);
            background: linear-gradient(135deg, #fafcfb 0%, #ffffff 100%);
        }

        .day-card.gym {
            border-color: var(--mist);
            background: linear-gradient(135deg, #faf9fc 0%, #ffffff 100%);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .calendar-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .grid-cell {
                padding: 8px;
            }

            .cell-date {
                font-size: 1rem;
            }

            .cell-day {
                font-size: 0.75rem;
            }

            .expanded-card {
                padding: 25px;
            }

            .view-controls {
                flex-direction: column;
            }

            .week-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
            }

            .header {
                background: linear-gradient(135deg, #e5dbe5 0%, #d8cdd8 100%) !important;
                color: #2d1b3d !important;
            }

            .view-controls,
            .expanded-view,
            .close-btn,
            .action-btns {
                display: none !important;
            }

            .list-view {
                display: block !important;
            }

            .calendar-grid {
                display: none !important;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--sage) 0%, var(--mist) 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            font-size: 1.1rem;
            font-weight: 600;
            animation: slideIn 0.3s ease;
        }
    </style>
</head>

<body>
    <div class="page-container">
        <header class="header">
            <h1>Ø¨Ø±Ù†Ø§Ù…Ø¬ ØµÙŠØ§Ù… ÙˆØµÙ„Ø§Ø© Ø¯Ø§ÙˆÙˆØ¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…</h1>
            <p class="subtitle">Ø±Ø­Ù„Ø© Ø±ÙˆØ­Ø§Ù†ÙŠØ© Ù…Ø¨Ø§Ø±ÙƒØ© â€¢ Ø´Ù‡Ø± ÙƒØ§Ù…Ù„ â€¢ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø§Ù„Ù…ØºØ±Ø¨ ğŸ‡²ğŸ‡¦</p>
        </header>

        <main class="content">
            <!-- View Controls -->
            <div class="view-controls">
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('grid')">ğŸ“… Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ©</button>
                    <button class="view-btn" onclick="switchView('list')">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                </div>
                
                <div class="action-btns">
                    <button class="action-btn" onclick="window.print()">
                        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                    <button class="action-btn" onclick="downloadNotes()">
                        ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                    </button>
                    <label class="action-btn" style="margin: 0;">
                        ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                        <input type="file" accept=".json" onchange="uploadNotes(event)" style="display: none;">
                    </label>
                </div>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-icon" style="background: var(--sage); color: white;">âœ“</div>
                    <span>ØªÙ… ÙƒØªØ§Ø¨Ø© Ù…Ù„Ø§Ø­Ø¸Ø§Øª</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon" style="background: linear-gradient(135deg, #f0f5ed, #fff); border: 2px solid var(--sage);">ğŸŒ™</div>
                    <span>ÙŠÙˆÙ… ØµÙŠØ§Ù…</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon" style="background: linear-gradient(135deg, #f5f0f7, #fff); border: 2px solid var(--lavender);">ğŸ’ª</div>
                    <span>ÙŠÙˆÙ… Ø¬ÙŠÙ…</span>
                </div>
            </div>

            <!-- Calendar Grid View -->
            <div id="calendarGrid" class="calendar-grid"></div>

            <!-- List View -->
            <div id="listView" class="list-view"></div>
        </main>

        <!-- Expanded Day View -->
        <div id="expandedView" class="expanded-view">
            <div class="expanded-card">
                <button class="close-btn" onclick="closeExpanded()">âœ•</button>
                <div id="expandedContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Prayer times and schedule data
        const prayerTimes = {
            '07/11': { fajr: '06:27', isha: '20:02', maghrib: '18:40' },
            '08/11': { fajr: '06:28', isha: '20:02', maghrib: '18:39' },
            '09/11': { fajr: '06:29', isha: '20:01', maghrib: '18:38' },
            '10/11': { fajr: '06:30', isha: '20:01', maghrib: '18:37' },
            '11/11': { fajr: '06:30', isha: '19:59', maghrib: '18:36' },
            '12/11': { fajr: '06:31', isha: '19:59', maghrib: '18:36' },
            '13/11': { fajr: '06:32', isha: '19:58', maghrib: '18:35' },
            '14/11': { fajr: '06:33', isha: '19:58', maghrib: '18:34' },
            '15/11': { fajr: '06:33', isha: '19:57', maghrib: '18:34' },
            '16/11': { fajr: '06:34', isha: '19:56', maghrib: '18:33' },
            '17/11': { fajr: '06:35', isha: '19:56', maghrib: '18:32' },
            '18/11': { fajr: '06:36', isha: '19:56', maghrib: '18:32' },
            '19/11': { fajr: '06:37', isha: '19:55', maghrib: '18:31' },
            '20/11': { fajr: '06:38', isha: '19:55', maghrib: '18:31' },
            '21/11': { fajr: '06:38', isha: '19:55', maghrib: '18:31' },
            '22/11': { fajr: '06:39', isha: '19:54', maghrib: '18:30' },
            '23/11': { fajr: '06:40', isha: '19:54', maghrib: '18:30' },
            '24/11': { fajr: '06:41', isha: '19:54', maghrib: '18:30' },
            '25/11': { fajr: '06:41', isha: '19:54', maghrib: '18:29' },
            '26/11': { fajr: '06:42', isha: '19:54', maghrib: '18:29' },
            '27/11': { fajr: '06:43', isha: '19:54', maghrib: '18:29' },
            '28/11': { fajr: '06:44', isha: '19:54', maghrib: '18:29' },
            '29/11': { fajr: '06:45', isha: '19:54', maghrib: '18:28' },
            '30/11': { fajr: '06:45', isha: '19:53', maghrib: '18:28' },
            '01/12': { fajr: '06:46', isha: '19:53', maghrib: '18:28' },
            '02/12': { fajr: '06:47', isha: '19:53', maghrib: '18:28' },
            '03/12': { fajr: '06:48', isha: '19:53', maghrib: '18:28' },
            '04/12': { fajr: '06:48', isha: '19:53', maghrib: '18:28' },
            '05/12': { fajr: '06:49', isha: '19:53', maghrib: '18:28' },
            '06/12': { fajr: '06:49', isha: '19:53', maghrib: '18:28' },
            '07/12': { fajr: '06:50', isha: '19:53', maghrib: '18:28' }
        };

        const schedule = [
            { date: '07/11', day: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', fasting: true, gym: false },
            { date: '08/11', day: 'Ø§Ù„Ø³Ø¨Øª', fasting: false, gym: true },
            { date: '09/11', day: 'Ø§Ù„Ø£Ø­Ø¯', fasting: true, gym: false },
            { date: '10/11', day: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', fasting: false, gym: false },
            { date: '11/11', day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', fasting: false, gym: true },
            { date: '12/11', day: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', fasting: true, gym: false },
            { date: '13/11', day: 'Ø§Ù„Ø®Ù…ÙŠØ³', fasting: false, gym: true },
            { date: '14/11', day: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', fasting: true, gym: false },
            { date: '15/11', day: 'Ø§Ù„Ø³Ø¨Øª', fasting: false, gym: true },
            { date: '16/11', day: 'Ø§Ù„Ø£Ø­Ø¯', fasting: true, gym: false },
            { date: '17/11', day: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', fasting: false, gym: false },
            { date: '18/11', day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', fasting: false, gym: true },
            { date: '19/11', day: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', fasting: true, gym: false },
            { date: '20/11', day: 'Ø§Ù„Ø®Ù…ÙŠØ³', fasting: false, gym: true },
            { date: '21/11', day: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', fasting: true, gym: false },
            { date: '22/11', day: 'Ø§Ù„Ø³Ø¨Øª', fasting: false, gym: true },
            { date: '23/11', day: 'Ø§Ù„Ø£Ø­Ø¯', fasting: true, gym: false },
            { date: '24/11', day: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', fasting: false, gym: false },
            { date: '25/11', day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', fasting: false, gym: true },
            { date: '26/11', day: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', fasting: true, gym: false },
            { date: '27/11', day: 'Ø§Ù„Ø®Ù…ÙŠØ³', fasting: false, gym: true },
            { date: '28/11', day: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', fasting: true, gym: false },
            { date: '29/11', day: 'Ø§Ù„Ø³Ø¨Øª', fasting: false, gym: true },
            { date: '30/11', day: 'Ø§Ù„Ø£Ø­Ø¯', fasting: true, gym: false },
            { date: '01/12', day: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', fasting: false, gym: false },
            { date: '02/12', day: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', fasting: false, gym: true },
            { date: '03/12', day: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', fasting: true, gym: false },
            { date: '04/12', day: 'Ø§Ù„Ø®Ù…ÙŠØ³', fasting: false, gym: true },
            { date: '05/12', day: 'Ø§Ù„Ø¬Ù…Ø¹Ø©', fasting: true, gym: false },
            { date: '06/12', day: 'Ø§Ù„Ø³Ø¨Øª', fasting: false, gym: true },
            { date: '07/12', day: 'Ø§Ù„Ø£Ø­Ø¯', fasting: true, gym: false }
        ];

        // Notes management
        const STORAGE_KEY = 'davidic_fasting_notes';
        let notesData = {};

        function loadNotes() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    notesData = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading notes:', e);
            }
        }

        function saveNotes() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(notesData));
            } catch (e) {
                console.error('Error saving notes:', e);
            }
        }

        function downloadNotes() {
            const dataStr = JSON.stringify(notesData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'davidic_fasting_notes_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…');
        }

        function uploadNotes(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    notesData = imported;
                    saveNotes();
                    
                    // Reload views
                    createGridView();
                    createListView();
                    
                    showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø£Ù†Ù‡ Ù…Ù„Ù JSON ØµØ­ÙŠØ­.');
                }
            };
            reader.readAsText(file);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function calculateDavidTimes(ishaTime, fajrTime) {
            const [ishaHour, ishaMin] = ishaTime.split(':').map(Number);
            const [fajrHour, fajrMin] = fajrTime.split(':').map(Number);
            
            let ishaMinutes = ishaHour * 60 + ishaMin;
            let fajrMinutes = fajrHour * 60 + fajrMin;
            
            if (fajrMinutes < ishaMinutes) {
                fajrMinutes += 24 * 60;
            }
            
            const nightDuration = fajrMinutes - ishaMinutes;
            const sleep1Start = ishaMinutes + 30;
            const halfNight = nightDuration / 2;
            const sleep1End = sleep1Start + halfNight;
            const thirdNight = nightDuration / 3;
            const qiyamEnd = sleep1End + thirdNight;
            const sleep2Start = qiyamEnd;
            
            function minutesToTime(mins) {
                let totalMins = mins % (24 * 60);
                const hours = Math.floor(totalMins / 60);
                const minutes = Math.round(totalMins % 60);
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
            
            return {
                sleep1Start: minutesToTime(sleep1Start),
                sleep1End: minutesToTime(sleep1End),
                qiyamStart: minutesToTime(sleep1End),
                qiyamEnd: minutesToTime(qiyamEnd),
                sleep2Start: minutesToTime(sleep2Start),
                sleep2End: fajrTime,
                nightDuration: Math.round(nightDuration / 60 * 10) / 10
            };
        }

        // Create Grid View
        function createGridView() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            schedule.forEach(day => {
                const cell = document.createElement('div');
                const hasNotes = notesData[day.date] && notesData[day.date].trim() !== '';
                
                cell.className = `grid-cell ${day.fasting ? 'fasting' : ''} ${day.gym ? 'gym' : ''} ${hasNotes ? 'has-notes' : ''}`;
                cell.onclick = () => openExpanded(day.date);

                const badges = [];
                if (day.fasting) badges.push('<div class="mini-badge fasting">ğŸŒ™ ØµÙŠØ§Ù…</div>');
                if (day.gym) badges.push('<div class="mini-badge gym">ğŸ’ª Ø¬ÙŠÙ…</div>');

                cell.innerHTML = `
                    <div>
                        <div class="cell-day">${day.day}</div>
                        <div class="cell-date">${day.date}</div>
                    </div>
                    <div class="cell-badges">
                        ${badges.join('')}
                    </div>
                `;

                grid.appendChild(cell);
            });
        }

        // Create List View
        function createListView() {
            const listView = document.getElementById('listView');
            listView.innerHTML = '';

            for (let i = 0; i < schedule.length; i += 7) {
                const weekSection = document.createElement('div');
                weekSection.className = 'week-section';

                const weekHeader = document.createElement('div');
                weekHeader.className = 'week-header';
                weekHeader.textContent = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${Math.floor(i / 7) + 1}`;
                weekSection.appendChild(weekHeader);

                const weekGrid = document.createElement('div');
                weekGrid.className = 'week-grid';

                schedule.slice(i, i + 7).forEach(day => {
                    const card = createDayCard(day);
                    weekGrid.appendChild(card);
                });

                weekSection.appendChild(weekGrid);
                listView.appendChild(weekSection);
            }
        }

        function createDayCard(day) {
            const card = document.createElement('div');
            card.className = `day-card ${day.fasting ? 'fasting' : ''} ${day.gym ? 'gym' : ''}`;
            card.onclick = () => openExpanded(day.date);
            card.style.cursor = 'pointer';

            const prayers = prayerTimes[day.date];
            const hasNotes = notesData[day.date] && notesData[day.date].trim() !== '';

            const badges = [];
            if (day.gym) badges.push('<span class="mini-badge gym">ğŸ’ª Ø¬ÙŠÙ…</span>');
            if (day.fasting) badges.push('<span class="mini-badge fasting" style="padding: 8px 16px;">ğŸŒ™ ØµÙŠØ§Ù… 36 Ø³Ø§Ø¹Ø©</span>');
            else badges.push('<span class="mini-badge" style="background: var(--champagne); color: var(--royal-plum); padding: 8px 16px;">ğŸ½ï¸ Ø¥ÙØ·Ø§Ø±</span>');

            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid var(--champagne);">
                    <div style="font-family: 'Amiri', serif; font-size: 1.4rem; font-weight: 700; color: var(--deep-purple);">${day.day}</div>
                    <div style="background: var(--cream); padding: 6px 14px; border-radius: 20px; font-weight: 600; color: var(--royal-plum);">${day.date}/2025</div>
                </div>
                
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                    ${badges.join('')}
                    ${hasNotes ? '<span style="background: var(--sage); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 600;">âœ“ ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</span>' : ''}
                </div>
                
                <div style="background: linear-gradient(135deg, var(--cream) 0%, #fdfbf9 100%); padding: 15px; border-radius: 12px; font-size: 0.95rem; color: var(--royal-plum);">
                    <div style="margin-bottom: 6px;"><strong>ğŸ•Œ Ø§Ù„Ø¹Ø´Ø§Ø¡:</strong> ${prayers.isha}</div>
                    <div style="margin-bottom: 6px;"><strong>ğŸŒ… Ø§Ù„ÙØ¬Ø±:</strong> ${prayers.fajr}</div>
                    <div><strong>ğŸŒ† Ø§Ù„Ù…ØºØ±Ø¨:</strong> ${prayers.maghrib}</div>
                </div>
            `;

            return card;
        }

        // Open Expanded View
        function openExpanded(date) {
            const day = schedule.find(d => d.date === date);
            const prayers = prayerTimes[date];
            const davidTimes = calculateDavidTimes(prayers.isha, prayers.fajr);
            const hasNotes = notesData[date] && notesData[date].trim() !== '';

            const [dayNum, monthNum] = date.split('/');
            let fastingEndDate = new Date(2025, parseInt(monthNum) - 1, parseInt(dayNum));
            fastingEndDate.setDate(fastingEndDate.getDate() + 1);
            let fastingEndTime = fastingEndDate.getDate().toString().padStart(2, '0') + '/' +
                (fastingEndDate.getMonth() + 1).toString().padStart(2, '0');

            const badges = [];
            if (day.gym) badges.push('<span class="mini-badge gym" style="padding: 10px 20px; font-size: 0.95rem;">ğŸ’ª Ø¬ÙŠÙ…</span>');
            if (day.fasting) badges.push('<span class="mini-badge fasting" style="padding: 10px 20px; font-size: 0.95rem;">ğŸŒ™ ØµÙŠØ§Ù… 36 Ø³Ø§Ø¹Ø©</span>');
            else badges.push('<span class="mini-badge" style="background: var(--champagne); color: var(--royal-plum); padding: 10px 20px; font-size: 0.95rem;">ğŸ½ï¸ Ø¥ÙØ·Ø§Ø±</span>');

            const content = `
                <div class="card-header">
                    <h2 class="card-title">${day.day}</h2>
                    <p class="card-date">${date}/2025</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px;">
                        ${badges.join('')}
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-title">ğŸ•Œ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©</div>
                    <div class="info-row">
                        <span class="info-label">ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡</span>
                        <span class="info-value">${prayers.isha}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø±</span>
                        <span class="info-value">${prayers.fajr}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Ø§Ù„Ù…ØºØ±Ø¨</span>
                        <span class="info-value">${prayers.maghrib}</span>
                    </div>
                </div>

                <div class="info-box" style="background: linear-gradient(135deg, #f0f5ed 0%, #fdfbf9 100%); border-color: var(--sage);">
                    <div class="info-title">âœ¨ Ø¬Ø¯ÙˆÙ„ ØµÙ„Ø§Ø© Ø¯Ø§ÙˆÙˆØ¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…</div>
                    <div class="info-row">
                        <span class="info-label">ğŸ˜´ Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø£ÙˆÙ„ (Ù†ØµÙ Ø§Ù„Ù„ÙŠÙ„)</span>
                        <span class="info-value">${davidTimes.sleep1Start} - ${davidTimes.sleep1End}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ¤² Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ (Ø«Ù„Ø« Ø§Ù„Ù„ÙŠÙ„)</span>
                        <span class="info-value">${davidTimes.qiyamStart} - ${davidTimes.qiyamEnd}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ğŸ’¤ Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø³Ø¯Ø³ Ø§Ù„Ù„ÙŠÙ„)</span>
                        <span class="info-value">${davidTimes.sleep2Start} - ${davidTimes.sleep2End}</span>
                    </div>
                    <div style="text-align: center; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--sage); color: var(--sage); font-style: italic;">
                        Ù…Ø¯Ø© Ø§Ù„Ù„ÙŠÙ„: ${davidTimes.nightDuration} Ø³Ø§Ø¹Ø§Øª
                    </div>
                </div>

                ${day.fasting ? `
                    <div class="info-box" style="background: linear-gradient(135deg, #fef9f0 0%, #fdfbf9 100%); border-color: var(--rose-gold);">
                        <div class="info-title">ğŸŒ™ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù…</div>
                        <div class="info-row">
                            <span class="info-label">ğŸŒ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙŠØ§Ù…</span>
                            <span class="info-value">${date} - ${prayers.maghrib}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ğŸŒ† Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙŠØ§Ù…</span>
                            <span class="info-value">${fastingEndTime} - ${prayers.maghrib}</span>
                        </div>
                    </div>
                ` : ''}

                <div class="notes-section">
                    <div class="notes-header">
                        <div class="notes-title">
                            <span>ğŸ“</span>
                            <span>Ù…Ø°ÙƒØ±Ø§ØªÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
                        </div>
                        <div class="save-indicator" id="saveIndicator-${date}" style="display: ${hasNotes ? 'flex' : 'none'};">
                            <span>âœ“</span>
                            <span>Ù…Ø­ÙÙˆØ¸</span>
                        </div>
                    </div>
                    <textarea 
                        id="notes-${date}"
                        data-date="${date}"
                        placeholder="Ø³Ø¬Ù„ÙŠ Ù‡Ù†Ø§ Ù…Ø´Ø§Ø¹Ø±ÙƒØŒ ØªØ£Ù…Ù„Ø§ØªÙƒ Ø§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠØ©ØŒ Ø£Ùˆ Ø£Ù‡Ø¯Ø§ÙÙƒ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ..."
                    >${notesData[date] || ''}</textarea>
                </div>
            `;

            document.getElementById('expandedContent').innerHTML = content;
            document.getElementById('expandedView').classList.add('active');

            // Add event listener to textarea
            const textarea = document.getElementById(`notes-${date}`);
            let saveTimeout;
            textarea.addEventListener('input', function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    if (this.value.trim() === '') {
                        delete notesData[this.dataset.date];
                        document.getElementById(`saveIndicator-${date}`).style.display = 'none';
                    } else {
                        notesData[this.dataset.date] = this.value;
                        document.getElementById(`saveIndicator-${date}`).style.display = 'flex';
                    }
                    saveNotes();
                    
                    // Refresh grid view to show/hide checkmark
                    createGridView();
                    createListView();
                }, 1000);
            });
        }

        function closeExpanded() {
            document.getElementById('expandedView').classList.remove('active');
        }

        // Switch between views
        function switchView(view) {
            const gridView = document.getElementById('calendarGrid');
            const listView = document.getElementById('listView');
            const buttons = document.querySelectorAll('.view-btn');

            buttons.forEach(btn => btn.classList.remove('active'));

            if (view === 'grid') {
                gridView.style.display = 'grid';
                listView.classList.remove('active');
                buttons[0].classList.add('active');
            } else {
                gridView.style.display = 'none';
                listView.classList.add('active');
                buttons[1].classList.add('active');
            }
        }

        // Initialize
        loadNotes();
        createGridView();
        createListView();

        // Close expanded view on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeExpanded();
            }
        });

        // Close expanded view on background click
        document.getElementById('expandedView').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExpanded();
            }
        });
    </script>
</body>

</html>
